module "prefix_alloc" {
  for_each = { for r in local.reservations : r.name => r }

  source        = "./modules/prefix_alloc"
  aggregate_id  = each.value.aggregate_id
  prefix_length = each.value.prefix_length
  tag_ids       = each.value.tag_ids
  description   = "Allocated by Terraform (${each.key})"
  role          = null
  status        = "active"

  # Pick the provider based on the env value
  providers = {
    netbox = each.value.env == "prod" ? netbox.prod : netbox.staging
  }
}
