# Step 1: Create Repository Secrets
This is the most important step for security. Never hardcode tokens or credentials in your workflow file.

Go to your GitHub repository > Settings > Secrets and variables > Actions. Click New repository secret for each of the following:

1. GH_ENTERPRISE_TOKEN:

This is a Personal Access Token (PAT) that the workflow will use to authenticate with your GitHub Enterprise instance.
To create one: Go to your GitHub Enterprise profile > Settings > Developer settings > Personal access tokens > Tokens (classic).
Click Generate new token (classic).
Give it a name (e.g., "Daily Report Action").
Set an expiration date.
Grant it the repo scope (this gives it read access to repositories).
Copy the generated token immediately and paste it as the value for the GH_ENTERPRISE_TOKEN secret.

2. SMTP_SERVER:

The address of your SMTP server (e.g., smtp.your-company.com:25).

3. EMAIL_FROM_NAME:

The display name for the "From" address (e.g., GitHub Reporter).

4. EMAIL_FROM_ADDR:

The email address for the "From" field (e.g., no-reply@your-company.com).

5. EMAIL_TO:

The comma-separated list of primary recipients.

6. EMAIL_CC:

The comma-separated list of CC recipients.



# Step 2: Update Your Bash Script Configurations
Your script is almost perfect for this. We just need to make sure the configuration variables are read from environment variables if they exist. This is a best practice for Actions.

Modify the configuration section of your github_pr_report.sh script to look like this. It will now use the environment variables from the workflow but still keep the default values for local runs.

```
# =================================================================================
#  CONFIGURATIONS - Uses environment variables if set, otherwise uses defaults.
# =================================================================================

# GitHub Enterprise hostname
GHE_HOSTNAME="${GHE_HOSTNAME:-github.your-company.com}"

# Threshold in days for highlighting old PRs
DAYS_THRESHOLD="${DAYS_THRESHOLD:-7}"

# Name of the generated HTML report file
HTML_OUTPUT_FILE="github_report_$(date +%Y-%m-%d).html"

# =================================================================================
#  EMAIL CONFIGURATIONS
# =================================================================================
SEND_EMAIL="${SEND_EMAIL:-true}"
SMTP_SERVER="${SMTP_SERVER:-smtp.your-company.com:25}"
EMAIL_FROM_NAME="${EMAIL_FROM_NAME:-GitHub Reporter}"
EMAIL_FROM_ADDR="${EMAIL_FROM_ADDR:-no-reply@your-company.com}"
EMAIL_TO="${EMAIL_TO:-dev-team@your-company.com}"
EMAIL_CC="${EMAIL_CC:-engineering-manager@your-company.com}"
```

# Step 3: Create the GitHub Actions Workflow File

In your repository, create a directory path: .github/workflows/.
Inside that directory, create a new file named daily-report.yml.
Paste the following content into daily-report.yml:

```yaml
# .github/workflows/daily-report.yml

name: Daily GitHub Health Report

# Controls when the action will run.
on:
  # Allows you to run this workflow manually from the Actions tab.
  workflow_dispatch:

  # Runs on a schedule (every weekday at 8:00 AM UTC).
  # Use https://crontab.guru/ to customize the schedule.
  schedule:
    - cron: '0 8 * * 1-5'

jobs:
  build-and-send-report:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out your repository code so we can access the script.
      - name: Check out repository
        uses: actions/checkout@v4

      # Step 2: Install the dependencies (gh CLI and jq).
      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y gh jq

      # Step 3: Authenticate the gh CLI with your GitHub Enterprise instance.
      - name: Authenticate to GitHub Enterprise
        run: |
          echo "${{ secrets.GH_ENTERPRISE_TOKEN }}" | gh auth login --hostname ${{ secrets.GHE_HOSTNAME }} --with-token
        env:
          GH_HOST: ${{ secrets.GHE_HOSTNAME }}

      # Step 4: Make the script executable.
      - name: Make script executable
        run: chmod +x ./github_pr_report.sh

      # Step 5: Run the Report Script with arguments.
      - name: Run GitHub Health Report
        # This example runs in 'org' mode.
        # To run in 'list' mode, comment out the 'org' line and uncomment the 'list' line.
        run: ./github_pr_report.sh "your-github-organization" org
        # run: ./github_pr_report.sh "your-github-organization" list "repo-one,repo-two"
        env:
          # Pass all secrets to the script as environment variables
          GHE_HOSTNAME: ${{ secrets.GHE_HOSTNAME }}
          SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
          EMAIL_FROM_NAME: ${{ secrets.EMAIL_FROM_NAME }}
          EMAIL_FROM_ADDR: ${{ secrets.EMAIL_FROM_ADDR }}
          EMAIL_TO: ${{ secrets.EMAIL_TO }}
          EMAIL_CC: ${{ secrets.EMAIL_CC }}
```

# Explanation of the Workflow File

- name:: The name of your workflow, which you'll see in the Actions tab.
- on:: This defines the triggers.
  -workflow_dispatch: Adds a "Run workflow" button in the GitHub UI, which is incredibly useful for testing.
  - schedule:: Uses a cron expression to run automatically. 0 8 * * 1-5 means "at 8:00 AM UTC, every day from Monday to Friday".

- jobs:: Defines a set of tasks to run.

- runs-on: ubuntu-latest: Specifies that the job will run on a fresh virtual machine hosted by GitHub, using the latest version of Ubuntu.

- steps:: A sequence of tasks.
  - actions/checkout@v4: A standard action that downloads your repository's code into the runner.
  - Install Dependencies: A simple run command to install gh and jq using the system's package manager.
  - Authenticate to GitHub Enterprise: This is a critical step. It securely takes the GH_ENTERPRISE_TOKEN you created and pipes it to gh auth login, so the CLI is authenticated for your GHE instance.
  - Run GitHub Health Report: This is the main step.
    - It executes your script. You need to customize this line! Replace "your-github-organization" with your actual org name. If you want to use list mode, comment out the org line and uncomment/edit the list line.
    - The env: block is where the magic happens. It maps the GitHub secrets you created to environment variables. Your updated Bash script will automatically pick these up.

# Final Steps

- Customize the run command in the workflow file to match your organization and desired scan mode.
- Commit and push the .github/workflows/daily-report.yml file to your repository's main branch.
- Go to the Actions tab of your repository. You will see the "Daily GitHub Health Report" workflow. You can click on it and use the "Run workflow" button to test it immediately.

That's it! Your report will now run automatically on schedule and send the email, all without any manual intervention.






